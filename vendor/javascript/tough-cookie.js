import e from"net";import t from"url";import o from"util";import"psl";import{e as r,a as i,b as n,c as a,d as s}from"../_/2fae765a.js";import u from"punycode";var l={};l="2.5.0";var f=l;var c={};var p=e;var h=t.parse;var k=o;var C=r;var m=i.Store;var y=n.MemoryCookieStore;var v=a.pathMatch;var x=f;var g;try{g=u}catch(e){console.warn("tough-cookie: can't load punycode; won't use punycode for domain normalization")}var d=/^[\x21\x23-\x2B\x2D-\x3A\x3C-\x5B\x5D-\x7E]+$/;var S=/[\x00-\x1F]/;var b=["\n","\r","\0"];var D=/[\x20-\x3A\x3C-\x7E]+/;var A=/[\x09\x20-\x2F\x3B-\x40\x5B-\x60\x7B-\x7E]/;var O={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var w=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var I=2147483647e3;var J=0;function parseDigits(e,t,o,r){var i=0;while(i<e.length){var n=e.charCodeAt(i);if(n<=47||n>=58)break;i++}return i<t||i>o?null:r||i==e.length?parseInt(e.substr(0,i),10):null}function parseTime(e){var t=e.split(":");var o=[0,0,0];if(3!==t.length)return null;for(var r=0;r<3;r++){var i=2==r;var n=parseDigits(t[r],1,2,i);if(null===n)return null;o[r]=n}return o}function parseMonth(e){e=String(e).substr(0,3).toLowerCase();var t=O[e];return t>=0?t:null}function parseDate(e){if(e){var t=e.split(A);if(t){var o=null;var r=null;var i=null;var n=null;var a=null;var s=null;for(var u=0;u<t.length;u++){var l=t[u].trim();if(l.length){var f;if(null===i){f=parseTime(l);if(f){o=f[0];r=f[1];i=f[2];continue}}if(null===n){f=parseDigits(l,1,2,true);if(null!==f){n=f;continue}}if(null===a){f=parseMonth(l);if(null!==f){a=f;continue}}if(null===s){f=parseDigits(l,2,4,true);if(null!==f){s=f;s>=70&&s<=99?s+=1900:s>=0&&s<=69&&(s+=2e3)}}}}if(!(null===n||null===a||null===s||null===i||n<1||n>31||s<1601||o>23||r>59||i>59))return new Date(Date.UTC(s,a,n,o,r,i))}}}function formatDate(e){var t=e.getUTCDate();t=t>=10?t:"0"+t;var o=e.getUTCHours();o=o>=10?o:"0"+o;var r=e.getUTCMinutes();r=r>=10?r:"0"+r;var i=e.getUTCSeconds();i=i>=10?i:"0"+i;return w[e.getUTCDay()]+", "+t+" "+P[e.getUTCMonth()]+" "+e.getUTCFullYear()+" "+o+":"+r+":"+i+" GMT"}function canonicalDomain(e){if(null==e)return null;e=e.trim().replace(/^\./,"");g&&/[^\u0001-\u007f]/.test(e)&&(e=g.toASCII(e));return e.toLowerCase()}function domainMatch(e,t,o){if(null==e||null==t)return null;if(false!==o){e=canonicalDomain(e);t=canonicalDomain(t)}if(e==t)return true;if(p.isIP(e))return false;var r=e.indexOf(t);return!(r<=0)&&(e.length===t.length+r&&"."===e.substr(r-1,1))}function defaultPath(e){if(!e||"/"!==e.substr(0,1))return"/";if("/"===e)return e;var t=e.lastIndexOf("/");return 0===t?"/":e.slice(0,t)}function trimTerminator(e){for(var t=0;t<b.length;t++){var o=e.indexOf(b[t]);-1!==o&&(e=e.substr(0,o))}return e}function parseCookiePair(e,t){e=trimTerminator(e);var o=e.indexOf("=");if(t){if(0===o){e=e.substr(1);o=e.indexOf("=")}}else if(o<=0)return;var r,i;if(o<=0){r="";i=e.trim()}else{r=e.substr(0,o).trim();i=e.substr(o+1).trim()}if(!S.test(r)&&!S.test(i)){var n=new Cookie;n.key=r;n.value=i;return n}}function parse(e,t){t&&"object"===typeof t||(t={});e=e.trim();var o=e.indexOf(";");var r=-1===o?e:e.substr(0,o);var i=parseCookiePair(r,!!t.loose);if(i){if(-1===o)return i;var n=e.slice(o+1).trim();if(0===n.length)return i;var a=n.split(";");while(a.length){var s=a.shift().trim();if(0!==s.length){var u=s.indexOf("=");var l,f;if(-1===u){l=s;f=null}else{l=s.substr(0,u);f=s.substr(u+1)}l=l.trim().toLowerCase();f&&(f=f.trim());switch(l){case"expires":if(f){var c=parseDate(f);c&&(i.expires=c)}break;case"max-age":if(f&&/^-?[0-9]+$/.test(f)){var p=parseInt(f,10);i.setMaxAge(p)}break;case"domain":if(f){var h=f.trim().replace(/^\./,"");h&&(i.domain=h.toLowerCase())}break;case"path":i.path=f&&"/"===f[0]?f:null;break;case"secure":i.secure=true;break;case"httponly":i.httpOnly=true;break;default:i.extensions=i.extensions||[];i.extensions.push(s);break}}}return i}}function jsonParse(e){var t;try{t=JSON.parse(e)}catch(e){return e}return t}function fromJSON(e){if(!e)return null;var t;if("string"===typeof e){t=jsonParse(e);if(t instanceof Error)return null}else t=e;var o=new Cookie;for(var r=0;r<Cookie.serializableProperties.length;r++){var i=Cookie.serializableProperties[r];void 0!==t[i]&&t[i]!==Cookie.prototype[i]&&("expires"===i||"creation"===i||"lastAccessed"===i?null===t[i]?o[i]=null:o[i]="Infinity"==t[i]?"Infinity":new Date(t[i]):o[i]=t[i])}return o}function cookieCompare(e,t){var o=0;var r=e.path?e.path.length:0;var i=t.path?t.path.length:0;o=i-r;if(0!==o)return o;var n=e.creation?e.creation.getTime():I;var a=t.creation?t.creation.getTime():I;o=n-a;if(0!==o)return o;o=e.creationIndex-t.creationIndex;return o}function permutePath(e){if("/"===e)return["/"];e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1));var t=[e];while(e.length>1){var o=e.lastIndexOf("/");if(0===o)break;e=e.substr(0,o);t.push(e)}t.push("/");return t}function getCookieContext(e){if(e instanceof Object)return e;try{e=decodeURI(e)}catch(e){}return h(e)}function Cookie(e){e=e||{};Object.keys(e).forEach((function(t){Cookie.prototype.hasOwnProperty(t)&&Cookie.prototype[t]!==e[t]&&"_"!==t.substr(0,1)&&(this[t]=e[t])}),this);this.creation=this.creation||new Date;Object.defineProperty(this,"creationIndex",{configurable:false,enumerable:false,writable:true,value:++Cookie.cookiesCreated})}Cookie.cookiesCreated=0;Cookie.parse=parse;Cookie.fromJSON=fromJSON;Cookie.prototype.key="";Cookie.prototype.value="";Cookie.prototype.expires="Infinity";Cookie.prototype.maxAge=null;Cookie.prototype.domain=null;Cookie.prototype.path=null;Cookie.prototype.secure=false;Cookie.prototype.httpOnly=false;Cookie.prototype.extensions=null;Cookie.prototype.hostOnly=null;Cookie.prototype.pathIsDefault=null;Cookie.prototype.creation=null;Cookie.prototype.lastAccessed=null;Object.defineProperty(Cookie.prototype,"creationIndex",{configurable:true,enumerable:false,writable:true,value:0});Cookie.serializableProperties=Object.keys(Cookie.prototype).filter((function(e){return!(Cookie.prototype[e]instanceof Function||"creationIndex"===e||"_"===e.substr(0,1))}));Cookie.prototype.inspect=function inspect(){var e=Date.now();return'Cookie="'+this.toString()+"; hostOnly="+(null!=this.hostOnly?this.hostOnly:"?")+"; aAge="+(this.lastAccessed?e-this.lastAccessed.getTime()+"ms":"?")+"; cAge="+(this.creation?e-this.creation.getTime()+"ms":"?")+'"'};k.inspect.custom&&(Cookie.prototype[k.inspect.custom]=Cookie.prototype.inspect);Cookie.prototype.toJSON=function(){var e={};var t=Cookie.serializableProperties;for(var o=0;o<t.length;o++){var r=t[o];this[r]!==Cookie.prototype[r]&&("expires"===r||"creation"===r||"lastAccessed"===r?null===this[r]?e[r]=null:e[r]="Infinity"==this[r]?"Infinity":this[r].toISOString():"maxAge"===r?null!==this[r]&&(e[r]=Infinity==this[r]||-Infinity==this[r]?this[r].toString():this[r]):this[r]!==Cookie.prototype[r]&&(e[r]=this[r]))}return e};Cookie.prototype.clone=function(){return fromJSON(this.toJSON())};Cookie.prototype.validate=function validate(){if(!d.test(this.value))return false;if(Infinity!=this.expires&&!(this.expires instanceof Date)&&!parseDate(this.expires))return false;if(null!=this.maxAge&&this.maxAge<=0)return false;if(null!=this.path&&!D.test(this.path))return false;var e=this.cdomain();if(e){if(e.match(/\.$/))return false;var t=C.getPublicSuffix(e);if(null==t)return false}return true};Cookie.prototype.setExpires=function setExpires(e){e instanceof Date?this.expires=e:this.expires=parseDate(e)||"Infinity"};Cookie.prototype.setMaxAge=function setMaxAge(e){this.maxAge=Infinity===e||-Infinity===e?e.toString():e};Cookie.prototype.cookieString=function cookieString(){var e=this.value;null==e&&(e="");return""===this.key?e:this.key+"="+e};Cookie.prototype.toString=function toString(){var e=this.cookieString();Infinity!=this.expires&&(this.expires instanceof Date?e+="; Expires="+formatDate(this.expires):e+="; Expires="+this.expires);null!=this.maxAge&&Infinity!=this.maxAge&&(e+="; Max-Age="+this.maxAge);this.domain&&!this.hostOnly&&(e+="; Domain="+this.domain);this.path&&(e+="; Path="+this.path);this.secure&&(e+="; Secure");this.httpOnly&&(e+="; HttpOnly");this.extensions&&this.extensions.forEach((function(t){e+="; "+t}));return e};Cookie.prototype.TTL=function TTL(e){if(null!=this.maxAge)return this.maxAge<=0?0:1e3*this.maxAge;var t=this.expires;if(Infinity!=t){t instanceof Date||(t=parseDate(t)||Infinity);return Infinity==t?Infinity:t.getTime()-(e||Date.now())}return Infinity};Cookie.prototype.expiryTime=function expiryTime(e){if(null!=this.maxAge){var t=e||this.creation||new Date;var o=this.maxAge<=0?-Infinity:1e3*this.maxAge;return t.getTime()+o}return Infinity==this.expires?Infinity:this.expires.getTime()};Cookie.prototype.expiryDate=function expiryDate(e){var t=this.expiryTime(e);return Infinity==t?new Date(I):-Infinity==t?new Date(J):new Date(t)};Cookie.prototype.isPersistent=function isPersistent(){return null!=this.maxAge||Infinity!=this.expires};Cookie.prototype.cdomain=Cookie.prototype.canonicalizedDomain=function canonicalizedDomain(){return null==this.domain?null:canonicalDomain(this.domain)};function CookieJar(e,t){"boolean"===typeof t?t={rejectPublicSuffixes:t}:null==t&&(t={});null!=t.rejectPublicSuffixes&&(this.rejectPublicSuffixes=t.rejectPublicSuffixes);null!=t.looseMode&&(this.enableLooseMode=t.looseMode);e||(e=new y);this.store=e}CookieJar.prototype.store=null;CookieJar.prototype.rejectPublicSuffixes=true;CookieJar.prototype.enableLooseMode=false;var T=[];T.push("setCookie");CookieJar.prototype.setCookie=function(e,t,o,r){var i;var n=getCookieContext(t);if(o instanceof Function){r=o;o={}}var a=canonicalDomain(n.hostname);var s=this.enableLooseMode;null!=o.loose&&(s=o.loose);e instanceof Cookie||(e=Cookie.parse(e,{loose:s}));if(!e){i=new Error("Cookie failed to parse");return r(o.ignoreError?null:i)}var u=o.now||new Date;if(this.rejectPublicSuffixes&&e.domain){var l=C.getPublicSuffix(e.cdomain());if(null==l){i=new Error("Cookie has domain set to a public suffix");return r(o.ignoreError?null:i)}}if(e.domain){if(!domainMatch(a,e.cdomain(),false)){i=new Error("Cookie not in this host's domain. Cookie:"+e.cdomain()+" Request:"+a);return r(o.ignoreError?null:i)}null==e.hostOnly&&(e.hostOnly=false)}else{e.hostOnly=true;e.domain=a}if(!e.path||"/"!==e.path[0]){e.path=defaultPath(n.pathname);e.pathIsDefault=true}if(false===o.http&&e.httpOnly){i=new Error("Cookie is HttpOnly and this isn't an HTTP API");return r(o.ignoreError?null:i)}var f=this.store;f.updateCookie||(f.updateCookie=function(e,t,o){this.putCookie(t,o)});function withCookie(t,i){if(t)return r(t);var next=function(t){if(t)return r(t);r(null,e)};if(i){if(false===o.http&&i.httpOnly){t=new Error("old Cookie is HttpOnly and this isn't an HTTP API");return r(o.ignoreError?null:t)}e.creation=i.creation;e.creationIndex=i.creationIndex;e.lastAccessed=u;f.updateCookie(i,e,next)}else{e.creation=e.lastAccessed=u;f.putCookie(e,next)}}f.findCookie(e.domain,e.path,e.key,withCookie)};T.push("getCookies");CookieJar.prototype.getCookies=function(e,t,o){var r=getCookieContext(e);if(t instanceof Function){o=t;t={}}var i=canonicalDomain(r.hostname);var n=r.pathname||"/";var a=t.secure;null!=a||!r.protocol||"https:"!=r.protocol&&"wss:"!=r.protocol||(a=true);var s=t.http;null==s&&(s=true);var u=t.now||Date.now();var l=false!==t.expire;var f=!!t.allPaths;var c=this.store;function matchingCookie(e){if(e.hostOnly){if(e.domain!=i)return false}else if(!domainMatch(i,e.domain,false))return false;if(!f&&!v(n,e.path))return false;if(e.secure&&!a)return false;if(e.httpOnly&&!s)return false;if(l&&e.expiryTime()<=u){c.removeCookie(e.domain,e.path,e.key,(function(){}));return false}return true}c.findCookies(i,f?null:n,(function(e,r){if(e)return o(e);r=r.filter(matchingCookie);false!==t.sort&&(r=r.sort(cookieCompare));var i=new Date;r.forEach((function(e){e.lastAccessed=i}));o(null,r)}))};T.push("getCookieString");CookieJar.prototype.getCookieString=function(){var e=Array.prototype.slice.call(arguments,0);var t=e.pop();var next=function(e,o){e?t(e):t(null,o.sort(cookieCompare).map((function(e){return e.cookieString()})).join("; "))};e.push(next);this.getCookies.apply(this,e)};T.push("getSetCookieStrings");CookieJar.prototype.getSetCookieStrings=function(){var e=Array.prototype.slice.call(arguments,0);var t=e.pop();var next=function(e,o){e?t(e):t(null,o.map((function(e){return e.toString()})))};e.push(next);this.getCookies.apply(this,e)};T.push("serialize");CookieJar.prototype.serialize=function(e){var t=this.store.constructor.name;"Object"===t&&(t=null);var o={version:"tough-cookie@"+x,storeType:t,rejectPublicSuffixes:!!this.rejectPublicSuffixes,cookies:[]};if(!(this.store.getAllCookies&&"function"===typeof this.store.getAllCookies))return e(new Error("store does not support getAllCookies and cannot be serialized"));this.store.getAllCookies((function(t,r){if(t)return e(t);o.cookies=r.map((function(e){e=e instanceof Cookie?e.toJSON():e;delete e.creationIndex;return e}));return e(null,o)}))};CookieJar.prototype.toJSON=function(){return this.serializeSync()};T.push("_importCookies");CookieJar.prototype._importCookies=function(e,t){var o=this;var r=e.cookies;if(!r||!Array.isArray(r))return t(new Error("serialized jar has no cookies array"));r=r.slice();function putNext(e){if(e)return t(e);if(!r.length)return t(e,o);var i;try{i=fromJSON(r.shift())}catch(e){return t(e)}if(null===i)return putNext(null);o.store.putCookie(i,putNext)}putNext()};CookieJar.deserialize=function(e,t,o){if(3!==arguments.length){o=t;t=null}var r;if("string"===typeof e){r=jsonParse(e);if(r instanceof Error)return o(r)}else r=e;var i=new CookieJar(t,r.rejectPublicSuffixes);i._importCookies(r,(function(e){if(e)return o(e);o(null,i)}))};CookieJar.deserializeSync=function(e,t){var o="string"===typeof e?JSON.parse(e):e;var r=new CookieJar(t,o.rejectPublicSuffixes);if(!r.store.synchronous)throw new Error("CookieJar store is not synchronous; use async API instead.");r._importCookiesSync(o);return r};CookieJar.fromJSON=CookieJar.deserializeSync;CookieJar.prototype.clone=function(e,t){if(1===arguments.length){t=e;e=null}this.serialize((function(o,r){if(o)return t(o);CookieJar.deserialize(r,e,t)}))};T.push("removeAllCookies");CookieJar.prototype.removeAllCookies=function(e){var t=this.store;if(t.removeAllCookies instanceof Function&&t.removeAllCookies!==m.prototype.removeAllCookies)return t.removeAllCookies(e);t.getAllCookies((function(o,r){if(o)return e(o);if(0===r.length)return e(null);var i=0;var n=[];function removeCookieCb(t){t&&n.push(t);i++;if(i===r.length)return e(n.length?n[0]:null)}r.forEach((function(e){t.removeCookie(e.domain,e.path,e.key,removeCookieCb)}))}))};CookieJar.prototype._cloneSync=syncWrap("clone");CookieJar.prototype.cloneSync=function(e){if(!e.synchronous)throw new Error("CookieJar clone destination store is not synchronous; use async API instead.");return this._cloneSync(e)};function syncWrap(e){return function(){if(!this.store.synchronous)throw new Error("CookieJar store is not synchronous; use async API instead.");var t=Array.prototype.slice.call(arguments);var o,r;t.push((function syncCb(e,t){o=e;r=t}));this[e].apply(this,t);if(o)throw o;return r}}T.forEach((function(e){CookieJar.prototype[e+"Sync"]=syncWrap(e)}));c.version=x;c.CookieJar=CookieJar;c.Cookie=Cookie;c.Store=m;c.MemoryCookieStore=y;c.parseDate=parseDate;c.formatDate=formatDate;c.parse=parse;c.fromJSON=fromJSON;c.domainMatch=domainMatch;c.defaultPath=defaultPath;c.pathMatch=v;c.getPublicSuffix=C.getPublicSuffix;c.cookieCompare=cookieCompare;c.permuteDomain=s.permuteDomain;c.permutePath=permutePath;c.canonicalDomain=canonicalDomain;const M=c.version,E=c.getPublicSuffix,j=c.permuteDomain;const N=c.CookieJar,z=c.Cookie,F=c.Store,L=c.MemoryCookieStore,U=c.parseDate,_=c.formatDate,H=c.parse,B=c.fromJSON,W=c.domainMatch,$=c.defaultPath,R=c.pathMatch,q=c.cookieCompare,G=c.permutePath,Y=c.canonicalDomain;export default c;export{z as Cookie,N as CookieJar,L as MemoryCookieStore,F as Store,Y as canonicalDomain,q as cookieCompare,$ as defaultPath,W as domainMatch,_ as formatDate,B as fromJSON,E as getPublicSuffix,H as parse,U as parseDate,R as pathMatch,j as permuteDomain,G as permutePath,M as version};

