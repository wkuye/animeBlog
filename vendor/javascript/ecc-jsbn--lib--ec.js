import t from"jsbn";var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};var r={exports:i};var n=t.BigInteger;var u=n.prototype.Barrett;function ECFieldElementFp(t,i){(this||e).x=i;(this||e).q=t}function feFpEquals(t){return t==(this||e)||(this||e).q.equals(t.q)&&(this||e).x.equals(t.x)}function feFpToBigInteger(){return(this||e).x}function feFpNegate(){return new ECFieldElementFp((this||e).q,(this||e).x.negate().mod((this||e).q))}function feFpAdd(t){return new ECFieldElementFp((this||e).q,(this||e).x.add(t.toBigInteger()).mod((this||e).q))}function feFpSubtract(t){return new ECFieldElementFp((this||e).q,(this||e).x.subtract(t.toBigInteger()).mod((this||e).q))}function feFpMultiply(t){return new ECFieldElementFp((this||e).q,(this||e).x.multiply(t.toBigInteger()).mod((this||e).q))}function feFpSquare(){return new ECFieldElementFp((this||e).q,(this||e).x.square().mod((this||e).q))}function feFpDivide(t){return new ECFieldElementFp((this||e).q,(this||e).x.multiply(t.toBigInteger().modInverse((this||e).q)).mod((this||e).q))}ECFieldElementFp.prototype.equals=feFpEquals;ECFieldElementFp.prototype.toBigInteger=feFpToBigInteger;ECFieldElementFp.prototype.negate=feFpNegate;ECFieldElementFp.prototype.add=feFpAdd;ECFieldElementFp.prototype.subtract=feFpSubtract;ECFieldElementFp.prototype.multiply=feFpMultiply;ECFieldElementFp.prototype.square=feFpSquare;ECFieldElementFp.prototype.divide=feFpDivide;function ECPointFp(t,i,r,u){(this||e).curve=t;(this||e).x=i;(this||e).y=r;(this||e).z=null==u?n.ONE:u;(this||e).zinv=null}function pointFpGetX(){null==(this||e).zinv&&((this||e).zinv=(this||e).z.modInverse((this||e).curve.q));var t=(this||e).x.toBigInteger().multiply((this||e).zinv);(this||e).curve.reduce(t);return(this||e).curve.fromBigInteger(t)}function pointFpGetY(){null==(this||e).zinv&&((this||e).zinv=(this||e).z.modInverse((this||e).curve.q));var t=(this||e).y.toBigInteger().multiply((this||e).zinv);(this||e).curve.reduce(t);return(this||e).curve.fromBigInteger(t)}function pointFpEquals(t){if(t==(this||e))return true;if(this.isInfinity())return t.isInfinity();if(t.isInfinity())return this.isInfinity();var i,r;i=t.y.toBigInteger().multiply((this||e).z).subtract((this||e).y.toBigInteger().multiply(t.z)).mod((this||e).curve.q);if(!i.equals(n.ZERO))return false;r=t.x.toBigInteger().multiply((this||e).z).subtract((this||e).x.toBigInteger().multiply(t.z)).mod((this||e).curve.q);return r.equals(n.ZERO)}function pointFpIsInfinity(){return null==(this||e).x&&null==(this||e).y||(this||e).z.equals(n.ZERO)&&!(this||e).y.toBigInteger().equals(n.ZERO)}function pointFpNegate(){return new ECPointFp((this||e).curve,(this||e).x,(this||e).y.negate(),(this||e).z)}function pointFpAdd(t){if(this.isInfinity())return t;if(t.isInfinity())return this||e;var i=t.y.toBigInteger().multiply((this||e).z).subtract((this||e).y.toBigInteger().multiply(t.z)).mod((this||e).curve.q);var r=t.x.toBigInteger().multiply((this||e).z).subtract((this||e).x.toBigInteger().multiply(t.z)).mod((this||e).curve.q);if(n.ZERO.equals(r))return n.ZERO.equals(i)?this.twice():(this||e).curve.getInfinity();var u=new n("3");var s=(this||e).x.toBigInteger();var o=(this||e).y.toBigInteger();var l=t.x.toBigInteger();var p=t.y.toBigInteger();var h=r.square();var a=h.multiply(r);var c=s.multiply(h);var g=i.square().multiply((this||e).z);var v=g.subtract(c.shiftLeft(1)).multiply(t.z).subtract(a).multiply(r).mod((this||e).curve.q);var f=c.multiply(u).multiply(i).subtract(o.multiply(a)).subtract(g.multiply(i)).multiply(t.z).add(i.multiply(a)).mod((this||e).curve.q);var d=a.multiply((this||e).z).multiply(t.z).mod((this||e).curve.q);return new ECPointFp((this||e).curve,(this||e).curve.fromBigInteger(v),(this||e).curve.fromBigInteger(f),d)}function pointFpTwice(){if(this.isInfinity())return this||e;if(0==(this||e).y.toBigInteger().signum())return(this||e).curve.getInfinity();var t=new n("3");var i=(this||e).x.toBigInteger();var r=(this||e).y.toBigInteger();var u=r.multiply((this||e).z);var s=u.multiply(r).mod((this||e).curve.q);var o=(this||e).curve.a.toBigInteger();var l=i.square().multiply(t);n.ZERO.equals(o)||(l=l.add((this||e).z.square().multiply(o)));l=l.mod((this||e).curve.q);var p=l.square().subtract(i.shiftLeft(3).multiply(s)).shiftLeft(1).multiply(u).mod((this||e).curve.q);var h=l.multiply(t).multiply(i).subtract(s.shiftLeft(1)).shiftLeft(2).multiply(s).subtract(l.square().multiply(l)).mod((this||e).curve.q);var a=u.square().multiply(u).shiftLeft(3).mod((this||e).curve.q);return new ECPointFp((this||e).curve,(this||e).curve.fromBigInteger(p),(this||e).curve.fromBigInteger(h),a)}function pointFpMultiply(t){if(this.isInfinity())return this||e;if(0==t.signum())return(this||e).curve.getInfinity();var i=t;var r=i.multiply(new n("3"));var u=this.negate();var s=this||e;var o;for(o=r.bitLength()-2;o>0;--o){s=s.twice();var l=r.testBit(o);var p=i.testBit(o);l!=p&&(s=s.add(l?this||e:u))}return s}function pointFpMultiplyTwo(t,i,r){var n;n=t.bitLength()>r.bitLength()?t.bitLength()-1:r.bitLength()-1;var u=(this||e).curve.getInfinity();var s=this.add(i);while(n>=0){u=u.twice();t.testBit(n)?u=r.testBit(n)?u.add(s):u.add(this||e):r.testBit(n)&&(u=u.add(i));--n}return u}ECPointFp.prototype.getX=pointFpGetX;ECPointFp.prototype.getY=pointFpGetY;ECPointFp.prototype.equals=pointFpEquals;ECPointFp.prototype.isInfinity=pointFpIsInfinity;ECPointFp.prototype.negate=pointFpNegate;ECPointFp.prototype.add=pointFpAdd;ECPointFp.prototype.twice=pointFpTwice;ECPointFp.prototype.multiply=pointFpMultiply;ECPointFp.prototype.multiplyTwo=pointFpMultiplyTwo;function ECCurveFp(t,i,r){(this||e).q=t;(this||e).a=this.fromBigInteger(i);(this||e).b=this.fromBigInteger(r);(this||e).infinity=new ECPointFp(this||e,null,null);(this||e).reducer=new u((this||e).q)}function curveFpGetQ(){return(this||e).q}function curveFpGetA(){return(this||e).a}function curveFpGetB(){return(this||e).b}function curveFpEquals(t){return t==(this||e)||(this||e).q.equals(t.q)&&(this||e).a.equals(t.a)&&(this||e).b.equals(t.b)}function curveFpGetInfinity(){return(this||e).infinity}function curveFpFromBigInteger(t){return new ECFieldElementFp((this||e).q,t)}function curveReduce(t){(this||e).reducer.reduce(t)}function curveFpDecodePointHex(t){switch(parseInt(t.substr(0,2),16)){case 0:return(this||e).infinity;case 2:case 3:return null;case 4:case 6:case 7:var i=(t.length-2)/2;var r=t.substr(2,i);var u=t.substr(i+2,i);return new ECPointFp(this||e,this.fromBigInteger(new n(r,16)),this.fromBigInteger(new n(u,16)));default:return null}}function curveFpEncodePointHex(t){if(t.isInfinity())return"00";var e=t.getX().toBigInteger().toString(16);var i=t.getY().toBigInteger().toString(16);var r=this.getQ().toString(16).length;r%2!=0&&r++;while(e.length<r)e="0"+e;while(i.length<r)i="0"+i;return"04"+e+i}ECCurveFp.prototype.getQ=curveFpGetQ;ECCurveFp.prototype.getA=curveFpGetA;ECCurveFp.prototype.getB=curveFpGetB;ECCurveFp.prototype.equals=curveFpEquals;ECCurveFp.prototype.getInfinity=curveFpGetInfinity;ECCurveFp.prototype.fromBigInteger=curveFpFromBigInteger;ECCurveFp.prototype.reduce=curveReduce;ECCurveFp.prototype.encodePointHex=curveFpEncodePointHex;ECCurveFp.prototype.decodePointHex=function(t){var i;switch(parseInt(t.substr(0,2),16)){case 0:return(this||e).infinity;case 2:i=false;case 3:void 0==i&&(i=true);var r=t.length-2;var u=t.substr(2,r);var s=this.fromBigInteger(new n(u,16));var o=s.multiply(s.square().add(this.getA())).add(this.getB());var l=o.sqrt();if(null==l)throw"Invalid point compression";var p=l.toBigInteger();p.testBit(0)!=i&&(l=this.fromBigInteger(this.getQ().subtract(p)));return new ECPointFp(this||e,s,l);case 4:case 6:case 7:var r=(t.length-2)/2;var u=t.substr(2,r);var h=t.substr(r+2,r);return new ECPointFp(this||e,this.fromBigInteger(new n(u,16)),this.fromBigInteger(new n(h,16)));default:return null}};ECCurveFp.prototype.encodeCompressedPointHex=function(t){if(t.isInfinity())return"00";var e=t.getX().toBigInteger().toString(16);var i=this.getQ().toString(16).length;i%2!=0&&i++;while(e.length<i)e="0"+e;var r;r=t.getY().toBigInteger().isEven()?"02":"03";return r+e};ECFieldElementFp.prototype.getR=function(){if(void 0!=(this||e).r)return(this||e).r;(this||e).r=null;var t=(this||e).q.bitLength();if(t>128){var i=(this||e).q.shiftRight(t-64);-1==i.intValue()&&((this||e).r=n.ONE.shiftLeft(t).subtract((this||e).q))}return(this||e).r};ECFieldElementFp.prototype.modMult=function(t,e){return this.modReduce(t.multiply(e))};ECFieldElementFp.prototype.modReduce=function(t){if(null!=this.getR()){var e=q.bitLength();while(t.bitLength()>e+1){var i=t.shiftRight(e);var r=t.subtract(i.shiftLeft(e));this.getR().equals(n.ONE)||(i=i.multiply(this.getR()));t=i.add(r)}while(t.compareTo(q)>=0)t=t.subtract(q)}else t=t.mod(q);return t};ECFieldElementFp.prototype.sqrt=function(){if(!(this||e).q.testBit(0))throw"unsupported";if((this||e).q.testBit(1)){var t=new ECFieldElementFp((this||e).q,(this||e).x.modPow((this||e).q.shiftRight(2).add(n.ONE),(this||e).q));return t.square().equals(this||e)?t:null}var i=(this||e).q.subtract(n.ONE);var r=i.shiftRight(1);if(!(this||e).x.modPow(r,(this||e).q).equals(n.ONE))return null;var u=i.shiftRight(2);var s=u.shiftLeft(1).add(n.ONE);var o=(this||e).x;var l=modDouble(modDouble(o));var p,h;do{var a;do{a=new n((this||e).q.bitLength(),new SecureRandom)}while(a.compareTo((this||e).q)>=0||!a.multiply(a).subtract(l).modPow(r,(this||e).q).equals(i));var c=this.lucasSequence(a,o,s);p=c[0];h=c[1];if(this.modMult(h,h).equals(l)){h.testBit(0)&&(h=h.add(q));h=h.shiftRight(1);return new ECFieldElementFp(q,h)}}while(p.equals(n.ONE)||p.equals(i));return null};ECFieldElementFp.prototype.lucasSequence=function(t,e,i){var r=i.bitLength();var u=i.getLowestSetBit();var s=n.ONE;var o=n.TWO;var l=t;var p=n.ONE;var h=n.ONE;for(var a=r-1;a>=u+1;--a){p=this.modMult(p,h);if(i.testBit(a)){h=this.modMult(p,e);s=this.modMult(s,l);o=this.modReduce(l.multiply(o).subtract(t.multiply(p)));l=this.modReduce(l.multiply(l).subtract(h.shiftLeft(1)))}else{h=p;s=this.modReduce(s.multiply(o).subtract(p));l=this.modReduce(l.multiply(o).subtract(t.multiply(p)));o=this.modReduce(o.multiply(o).subtract(p.shiftLeft(1)))}}p=this.modMult(p,h);h=this.modMult(p,e);s=this.modReduce(s.multiply(o).subtract(p));o=this.modReduce(l.multiply(o).subtract(t.multiply(p)));p=this.modMult(p,h);for(var a=1;a<=u;++a){s=this.modMult(s,o);o=this.modReduce(o.multiply(o).subtract(p.shiftLeft(1)));p=this.modMult(p,p)}return[s,o]};var i={ECCurveFp:ECCurveFp,ECPointFp:ECPointFp,ECFieldElementFp:ECFieldElementFp};r.exports=i;var s=r.exports;export default s;

