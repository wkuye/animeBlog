import e from"stream";import t from"util";var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var r={};var i=e.Stream;var s=t;r=DelayedStream;function DelayedStream(){(this||a).source=null;(this||a).dataSize=0;(this||a).maxDataSize=1024*1024;(this||a).pauseStream=true;(this||a)._maxDataSizeExceeded=false;(this||a)._released=false;(this||a)._bufferedEvents=[]}s.inherits(DelayedStream,i);DelayedStream.create=function(e,t){var r=new(this||a);t=t||{};for(var i in t)r[i]=t[i];r.source=e;var s=e.emit;e.emit=function(){r._handleEmit(arguments);return s.apply(e,arguments)};e.on("error",(function(){}));r.pauseStream&&e.pause();return r};Object.defineProperty(DelayedStream.prototype,"readable",{configurable:true,enumerable:true,get:function(){return(this||a).source.readable}});DelayedStream.prototype.setEncoding=function(){return(this||a).source.setEncoding.apply((this||a).source,arguments)};DelayedStream.prototype.resume=function(){(this||a)._released||this.release();(this||a).source.resume()};DelayedStream.prototype.pause=function(){(this||a).source.pause()};DelayedStream.prototype.release=function(){(this||a)._released=true;(this||a)._bufferedEvents.forEach(function(e){(this||a).emit.apply(this||a,e)}.bind(this||a));(this||a)._bufferedEvents=[]};DelayedStream.prototype.pipe=function(){var e=i.prototype.pipe.apply(this||a,arguments);this.resume();return e};DelayedStream.prototype._handleEmit=function(e){if((this||a)._released)(this||a).emit.apply(this||a,e);else{if("data"===e[0]){(this||a).dataSize+=e[1].length;this._checkIfMaxDataSizeExceeded()}(this||a)._bufferedEvents.push(e)}};DelayedStream.prototype._checkIfMaxDataSizeExceeded=function(){if(!(this||a)._maxDataSizeExceeded&&!((this||a).dataSize<=(this||a).maxDataSize)){(this||a)._maxDataSizeExceeded=true;var e="DelayedStream#maxDataSize of "+(this||a).maxDataSize+" bytes exceeded.";this.emit("error",new Error(e))}};var o=r;export default o;

