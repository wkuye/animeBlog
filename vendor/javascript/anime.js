import e from"request";import s from"xml2js";import t from"fs";import a from"process";var n={USER_AGENT:"api-team-692e8861471e4de2fd84f6d91d1175c0",VERIFY_CREDENTIALS:"http://myanimelist.net/api/account/verify_credentials.xml",SEARCH:"http://myanimelist.net/api/anime/search.xml?q=",ADD:"http://myanimelist.net/api/animelist/add/"};var r="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};var o=a;var u=e;var l=s.parseString;var c=t;var d=n;i=function(e){e.login=function(e,s,t){var a=this||r;var n={success:true,username:"",id:"",message:""};u({url:d["VERIFY_CREDENTIALS"],headers:{"User-Agent":d["USER_AGENT"]},auth:{user:e,pass:s,sendImmediately:true}},(function(a,r,i){if(a||200!==r.statusCode){n.success=false;n.message="Credentials not valid";t(n)}else saveLogin(e,s,(function(e){if(e){n.success=false;n.message="Credentials could not be saved";t(n)}else l(i,(function(e,s){n.username=s.user.username[0];n.id=s.user.id[0];t(n)}))}))}))};e.logout=function(e){removeLogin(e)};e.retrieveLogin=function(e){c.readFile(getAuthFile(),(function(s,t){var a={};s||(a=JSON.parse(t));e(s,a)}))};function saveLogin(e,s,t){var a=JSON.stringify({username:e,password:s});c.writeFile(getAuthFile(),a,(function(e){t(e)}))}function removeLogin(e){c.unlink(getAuthFile(),e)}function getAuthFile(){var e=o.env["win32"==o.platform?"USERPROFILE":"HOME"];return e+"/.anime"}};var f=i;var m={};var v=e;var g=s.parseString;var p=n;m=function(e){e.search=function(s,t){var a={success:true,message:""};e.retrieveLogin((function(e,n){if(e){a.success=false;a.message="Please login with `anime login`";t(a)}else search(s,n,t,a)}))};function search(e,s,t,a){v({url:p["SEARCH"]+encodeURIComponent(e),headers:{"User-Agent":p["USER_AGENT"]},auth:{user:s.username,pass:s.password,sendImmediately:true}},(function(e,s,n){if(e||200!==s.statusCode){a.success=false;a.message=s&&204===s.statusCode?"No such animes found":e.toString();t(a)}else g(n,(function(e,s){var n=[];var r=s.anime.entry;for(var i=0;i<Math.min(10,r.length);i++){var o="[object Array]"===toString.call(r[i].english)?r[i].english[0]:r[i].english;var u={title:r[i].title[0],id:r[i].id[0],english:o,episodes:r[i].episodes[0]};n.push(u)}a.searchResults=n;t(a)}))}))}};var h=m;var E={};var A=e;var S=s.parseString;var y=n;E=function(e){e.add=function(s,t,a,n){var r={success:true,message:""};e.retrieveLogin((function(e,i){add(s,t,a,i,n,r)}))};function add(e,s,t,a,n,r){A({url:y["ADD"]+e+".xml",auth:{user:a.username,pass:a.password,sendImmediately:true},headers:{"User-Agent":y["USER_AGENT"]},method:"POST",form:constructXML(s,t)},(function(e,s,t){if(e||20!==Math.floor(s.statusCode/10)){r.success=false;r.message=s.statusCode;n(r)}else n(r)}))}function constructXML(e,s){return{data:'<?xml version="1.0" encoding="UTF-8"?>'+"<entry>"+"<status>"+s+"</status>"+"<episode>"+("completed"===s?e:"0")+"</episode>"+"</entry>"}}};var R=E;var C={};var L={};f(L);h(L);R(L);C=L;var F=C;export default F;

