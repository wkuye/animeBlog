import e from"util";import t from"stream";import i from"delayed-stream";import r from"buffer";var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};var n=r.Buffer;var o=e;var m=t.Stream;var h=i;s=CombinedStream;function CombinedStream(){(this||a).writable=false;(this||a).readable=true;(this||a).dataSize=0;(this||a).maxDataSize=2*1024*1024;(this||a).pauseStreams=true;(this||a)._released=false;(this||a)._streams=[];(this||a)._currentStream=null;(this||a)._insideLoop=false;(this||a)._pendingNext=false}o.inherits(CombinedStream,m);CombinedStream.create=function(e){var t=new(this||a);e=e||{};for(var i in e)t[i]=e[i];return t};CombinedStream.isStreamLike=function(e){return"function"!==typeof e&&"string"!==typeof e&&"boolean"!==typeof e&&"number"!==typeof e&&!n.isBuffer(e)};CombinedStream.prototype.append=function(e){var t=CombinedStream.isStreamLike(e);if(t){if(!(e instanceof h)){var i=h.create(e,{maxDataSize:Infinity,pauseStream:(this||a).pauseStreams});e.on("data",(this||a)._checkDataSize.bind(this||a));e=i}this._handleErrors(e);(this||a).pauseStreams&&e.pause()}(this||a)._streams.push(e);return this||a};CombinedStream.prototype.pipe=function(e,t){m.prototype.pipe.call(this||a,e,t);this.resume();return e};CombinedStream.prototype._getNext=function(){(this||a)._currentStream=null;if((this||a)._insideLoop)(this||a)._pendingNext=true;else{(this||a)._insideLoop=true;try{do{(this||a)._pendingNext=false;this._realGetNext()}while((this||a)._pendingNext)}finally{(this||a)._insideLoop=false}}};CombinedStream.prototype._realGetNext=function(){var e=(this||a)._streams.shift();if("undefined"!=typeof e)if("function"===typeof e){var t=e;t(function(e){var t=CombinedStream.isStreamLike(e);if(t){e.on("data",(this||a)._checkDataSize.bind(this||a));this._handleErrors(e)}this._pipeNext(e)}.bind(this||a))}else this._pipeNext(e);else this.end()};CombinedStream.prototype._pipeNext=function(e){(this||a)._currentStream=e;var t=CombinedStream.isStreamLike(e);if(t){e.on("end",(this||a)._getNext.bind(this||a));e.pipe(this||a,{end:false})}else{var i=e;this.write(i);this._getNext()}};CombinedStream.prototype._handleErrors=function(e){var t=this||a;e.on("error",(function(e){t._emitError(e)}))};CombinedStream.prototype.write=function(e){this.emit("data",e)};CombinedStream.prototype.pause=function(){if((this||a).pauseStreams){(this||a).pauseStreams&&(this||a)._currentStream&&"function"==typeof(this||a)._currentStream.pause&&(this||a)._currentStream.pause();this.emit("pause")}};CombinedStream.prototype.resume=function(){if(!(this||a)._released){(this||a)._released=true;(this||a).writable=true;this._getNext()}(this||a).pauseStreams&&(this||a)._currentStream&&"function"==typeof(this||a)._currentStream.resume&&(this||a)._currentStream.resume();this.emit("resume")};CombinedStream.prototype.end=function(){this._reset();this.emit("end")};CombinedStream.prototype.destroy=function(){this._reset();this.emit("close")};CombinedStream.prototype._reset=function(){(this||a).writable=false;(this||a)._streams=[];(this||a)._currentStream=null};CombinedStream.prototype._checkDataSize=function(){this._updateDataSize();if(!((this||a).dataSize<=(this||a).maxDataSize)){var e="DelayedStream#maxDataSize of "+(this||a).maxDataSize+" bytes exceeded.";this._emitError(new Error(e))}};CombinedStream.prototype._updateDataSize=function(){(this||a).dataSize=0;var e=this||a;(this||a)._streams.forEach((function(t){t.dataSize&&(e.dataSize+=t.dataSize)}));(this||a)._currentStream&&(this||a)._currentStream.dataSize&&((this||a).dataSize+=(this||a)._currentStream.dataSize)};CombinedStream.prototype._emitError=function(e){this._reset();this.emit("error",e)};var p=s;export default p;

