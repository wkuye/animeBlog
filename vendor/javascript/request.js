import e from"extend";import t from"tough-cookie";import"json-stringify-safe";import r from"crypto";import o from"safe-buffer";import a from"process";import n from"./lib/helpers.js";import s from"http";import i from"https";import u from"url";import p from"util";import c from"stream";import d from"zlib";import h from"aws-sign2";import l from"aws4";import f from"http-signature";import m from"mime-types";import v from"caseless";import y from"forever-agent";import g from"form-data";import b from"isstream";import q from"is-typedarray";import w from"qs";import H from"querystring";import _ from"fs";import R from"har-validator";import k from"uuid/v4";import x from"oauth-sign";import O from"combined-stream";import T from"tunnel-agent";import j from"performance-now";var S={};var E=t;var C=E.Cookie;var A=E.CookieJar;S.parse=function(e){e&&e.uri&&(e=e.uri);if("string"!==typeof e)throw new Error("The cookie function only accepts STRING as param");return C.parse(e,{loose:true})};function RequestJar(e){var t=this;t._jar=new A(e,{looseMode:true})}RequestJar.prototype.setCookie=function(e,t,r){var o=this;return o._jar.setCookieSync(e,t,r||{})};RequestJar.prototype.getCookieString=function(e){var t=this;return t._jar.getCookieStringSync(e)};RequestJar.prototype.getCookies=function(e){var t=this;return t._jar.getCookiesSync(e)};S.jar=function(e){return new RequestJar(e)};var P={};var D=a;function formatHostname(e){return e.replace(/^\.*/,".").toLowerCase()}function parseNoProxyZone(e){e=e.trim().toLowerCase();var t=e.split(":",2);var r=formatHostname(t[0]);var o=t[1];var a=e.indexOf(":")>-1;return{hostname:r,port:o,hasPort:a}}function uriInNoProxy(e,t){var r=e.port||("https:"===e.protocol?"443":"80");var o=formatHostname(e.hostname);var a=t.split(",");return a.map(parseNoProxyZone).some((function(e){var t=o.indexOf(e.hostname);var a=t>-1&&t===o.length-e.hostname.length;return e.hasPort?r===e.port&&a:a}))}function getProxyFromURI(e){var t=D.env.NO_PROXY||D.env.no_proxy||"";return"*"===t||""!==t&&uriInNoProxy(e,t)?null:"http:"===e.protocol?D.env.HTTP_PROXY||D.env.http_proxy||null:"https:"===e.protocol&&(D.env.HTTPS_PROXY||D.env.https_proxy||D.env.HTTP_PROXY||D.env.http_proxy)||null}P=getProxyFromURI;var z=P;var L={};var U=w;var N=H;function Querystring(e){this.request=e;this.lib=null;this.useQuerystring=null;this.parseOptions=null;this.stringifyOptions=null}Querystring.prototype.init=function(e){if(!this.lib){this.useQuerystring=e.useQuerystring;this.lib=this.useQuerystring?N:U;this.parseOptions=e.qsParseOptions||{};this.stringifyOptions=e.qsStringifyOptions||{}}};Querystring.prototype.stringify=function(e){return this.useQuerystring?this.rfc3986(this.lib.stringify(e,this.stringifyOptions.sep||null,this.stringifyOptions.eq||null,this.stringifyOptions)):this.lib.stringify(e,this.stringifyOptions)};Querystring.prototype.parse=function(e){return this.useQuerystring?this.lib.parse(e,this.parseOptions.sep||null,this.parseOptions.eq||null,this.parseOptions):this.lib.parse(e,this.parseOptions)};Querystring.prototype.rfc3986=function(e){return e.replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))};Querystring.prototype.unescape=N.unescape;L.Querystring=Querystring;var M={};var F=_;var B=H;var I=R;var J=e;function Har(e){this.request=e}Har.prototype.reducer=function(e,t){if(void 0===e[t.name]){e[t.name]=t.value;return e}var r=[e[t.name],t.value];e[t.name]=r;return e};Har.prototype.prep=function(e){e.queryObj={};e.headersObj={};e.postData.jsonObj=false;e.postData.paramsObj=false;e.queryString&&e.queryString.length&&(e.queryObj=e.queryString.reduce(this.reducer,{}));e.headers&&e.headers.length&&(e.headersObj=e.headers.reduceRight((function(e,t){e[t.name]=t.value;return e}),{}));if(e.cookies&&e.cookies.length){var t=e.cookies.map((function(e){return e.name+"="+e.value}));t.length&&(e.headersObj.cookie=t.join("; "))}function some(t){return t.some((function(t){return 0===e.postData.mimeType.indexOf(t)}))}if(some(["multipart/mixed","multipart/related","multipart/form-data","multipart/alternative"]))e.postData.mimeType="multipart/form-data";else if(some(["application/x-www-form-urlencoded"]))if(e.postData.params){e.postData.paramsObj=e.postData.params.reduce(this.reducer,{});e.postData.text=B.stringify(e.postData.paramsObj)}else e.postData.text="";else if(some(["text/json","text/x-json","application/json","application/x-json"])){e.postData.mimeType="application/json";if(e.postData.text)try{e.postData.jsonObj=JSON.parse(e.postData.text)}catch(t){this.request.debug(t);e.postData.mimeType="text/plain"}}return e};Har.prototype.options=function(e){if(!e.har)return e;var t={};J(t,e.har);t.log&&t.log.entries&&(t=t.log.entries[0]);t.url=t.url||e.url||e.uri||e.baseUrl||"/";t.httpVersion=t.httpVersion||"HTTP/1.1";t.queryString=t.queryString||[];t.headers=t.headers||[];t.cookies=t.cookies||[];t.postData=t.postData||{};t.postData.mimeType=t.postData.mimeType||"application/octet-stream";t.bodySize=0;t.headersSize=0;t.postData.size=0;if(!I.request(t))return e;var r=this.prep(t);r.url&&(e.url=r.url);r.method&&(e.method=r.method);Object.keys(r.queryObj).length&&(e.qs=r.queryObj);Object.keys(r.headersObj).length&&(e.headers=r.headersObj);function test(e){return 0===r.postData.mimeType.indexOf(e)}if(test("application/x-www-form-urlencoded"))e.form=r.postData.paramsObj;else if(test("application/json")){if(r.postData.jsonObj){e.body=r.postData.jsonObj;e.json=true}}else if(test("multipart/form-data")){e.formData={};r.postData.params.forEach((function(t){var r={};if(t.fileName||t.contentType){t.fileName&&!t.value?r.value=F.createReadStream(t.fileName):t.value&&(r.value=t.value);t.fileName&&(r.options={filename:t.fileName,contentType:t.contentType?t.contentType:null});e.formData[t.name]=r}else e.formData[t.name]=t.value}))}else r.postData.text&&(e.body=r.postData.text);return e};M.Har=Har;var Q={};var W=v;var Y=k;var G=n;var X=G.md5;var K=G.toBase64;function Auth(e){this.request=e;this.hasAuth=false;this.sentAuth=false;this.bearerToken=null;this.user=null;this.pass=null}Auth.prototype.basic=function(e,t,r){var o=this;("string"!==typeof e||void 0!==t&&"string"!==typeof t)&&o.request.emit("error",new Error("auth() received invalid user or password"));o.user=e;o.pass=t;o.hasAuth=true;var a=e+":"+(t||"");if(r||"undefined"===typeof r){var n="Basic "+K(a);o.sentAuth=true;return n}};Auth.prototype.bearer=function(e,t){var r=this;r.bearerToken=e;r.hasAuth=true;if(t||"undefined"===typeof t){"function"===typeof e&&(e=e());var o="Bearer "+(e||"");r.sentAuth=true;return o}};Auth.prototype.digest=function(e,t,r){var o=this;var a={};var n=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;while(true){var s=n.exec(r);if(!s)break;a[s[1]]=s[2]||s[3]}var ha1Compute=function(e,t,r,o,a,n){var s=X(t+":"+r+":"+o);return e&&"md5-sess"===e.toLowerCase()?X(s+":"+a+":"+n):s};var i=/(^|,)\s*auth\s*($|,)/.test(a.qop)&&"auth";var u=i&&"00000001";var p=i&&Y().replace(/-/g,"");var c=ha1Compute(a.algorithm,o.user,a.realm,o.pass,a.nonce,p);var d=X(e+":"+t);var h=X(i?c+":"+a.nonce+":"+u+":"+p+":"+i+":"+d:c+":"+a.nonce+":"+d);var l={username:o.user,realm:a.realm,nonce:a.nonce,uri:t,qop:i,response:h,nc:u,cnonce:p,algorithm:a.algorithm,opaque:a.opaque};r=[];for(var f in l)l[f]&&("qop"===f||"nc"===f||"algorithm"===f?r.push(f+"="+l[f]):r.push(f+'="'+l[f]+'"'));r="Digest "+r.join(", ");o.sentAuth=true;return r};Auth.prototype.onRequest=function(e,t,r,o){var a=this;var n=a.request;var s;void 0===o&&void 0===e?a.request.emit("error",new Error("no auth mechanism defined")):s=void 0!==o?a.bearer(o,r):a.basic(e,t,r);s&&n.setHeader("authorization",s)};Auth.prototype.onResponse=function(e){var t=this;var r=t.request;if(!t.hasAuth||t.sentAuth)return null;var o=W(e.headers);var a=o.get("www-authenticate");var n=a&&a.split(" ")[0].toLowerCase();r.debug("reauth",n);switch(n){case"basic":return t.basic(t.user,t.pass,true);case"bearer":return t.bearer(t.bearerToken,true);case"digest":return t.digest(r.method,r.path,a)}};Q.Auth=Auth;var Z={};var V=u;var $=w;var ee=v;var te=k;var re=x;var oe=r;var ae=o.Buffer;function OAuth(e){this.request=e;this.params=null}OAuth.prototype.buildParams=function(e,t,r,o,a,n){var s={};for(var i in e)s["oauth_"+i]=e[i];s.oauth_version||(s.oauth_version="1.0");s.oauth_timestamp||(s.oauth_timestamp=Math.floor(Date.now()/1e3).toString());s.oauth_nonce||(s.oauth_nonce=te().replace(/-/g,""));s.oauth_signature_method||(s.oauth_signature_method="HMAC-SHA1");var u=s.oauth_consumer_secret||s.oauth_private_key;delete s.oauth_consumer_secret;delete s.oauth_private_key;var p=s.oauth_token_secret;delete s.oauth_token_secret;var c=s.oauth_realm;delete s.oauth_realm;delete s.oauth_transport_method;var d=t.protocol+"//"+t.host+t.pathname;var h=n.parse([].concat(o,a,n.stringify(s)).join("&"));s.oauth_signature=re.sign(s.oauth_signature_method,r,d,h,u,p);c&&(s.realm=c);return s};OAuth.prototype.buildBodyHash=function(e,t){["HMAC-SHA1","RSA-SHA1"].indexOf(e.signature_method||"HMAC-SHA1")<0&&this.request.emit("error",new Error("oauth: "+e.signature_method+" signature_method not supported with body_hash signing."));var r=oe.createHash("sha1");r.update(t||"");var o=r.digest("hex");return ae.from(o,"hex").toString("base64")};OAuth.prototype.concatParams=function(e,t,r){r=r||"";var o=Object.keys(e).filter((function(e){return"realm"!==e&&"oauth_signature"!==e})).sort();e.realm&&o.splice(0,0,"realm");o.push("oauth_signature");return o.map((function(t){return t+"="+r+re.rfc3986(e[t])+r})).join(t)};OAuth.prototype.onRequest=function(e){var t=this;t.params=e;var r=t.request.uri||{};var o=t.request.method||"";var a=ee(t.request.headers);var n=t.request.body||"";var s=t.request.qsLib||$;var i;var u;var p=a.get("content-type")||"";var c="application/x-www-form-urlencoded";var d=e.transport_method||"header";if(p.slice(0,c.length)===c){p=c;i=n}r.query&&(u=r.query);"body"!==d||"POST"===o&&p===c||t.request.emit("error",new Error("oauth: transport_method of body requires POST "+"and content-type "+c));i||"boolean"!==typeof e.body_hash||(e.body_hash=t.buildBodyHash(e,t.request.body.toString()));var h=t.buildParams(e,r,o,u,i,s);switch(d){case"header":t.request.setHeader("Authorization","OAuth "+t.concatParams(h,",",'"'));break;case"query":var l=t.request.uri.href+=(u?"&":"?")+t.concatParams(h,"&");t.request.uri=V.parse(l);t.request.path=t.request.uri.path;break;case"body":t.request.body=(i?i+"&":"")+t.concatParams(h,"&");break;default:t.request.emit("error",new Error("oauth: transport_method invalid"))}};Z.OAuth=OAuth;var ne={};var se=r;function randomString(e){var t=6*(e+1);var r=se.randomBytes(Math.ceil(t/8));var o=r.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return o.slice(0,e)}function calculatePayloadHash(e,t,r){var o=se.createHash(t);o.update("hawk.1.payload\n");o.update((r?r.split(";")[0].trim().toLowerCase():"")+"\n");o.update(e||"");o.update("\n");return o.digest("base64")}ne.calculateMac=function(e,t){var r="hawk.1.header\n"+t.ts+"\n"+t.nonce+"\n"+(t.method||"").toUpperCase()+"\n"+t.resource+"\n"+t.host.toLowerCase()+"\n"+t.port+"\n"+(t.hash||"")+"\n";t.ext&&(r+=t.ext.replace("\\","\\\\").replace("\n","\\n"));r+="\n";t.app&&(r=r+t.app+"\n"+(t.dlg||"")+"\n");var o=se.createHmac(e.algorithm,e.key).update(r);var a=o.digest("base64");return a};ne.header=function(e,t,r){var o=r.timestamp||Math.floor((Date.now()+(r.localtimeOffsetMsec||0))/1e3);var a=r.credentials;if(!a||!a.id||!a.key||!a.algorithm)return"";if(-1===["sha1","sha256"].indexOf(a.algorithm))return"";var n={ts:o,nonce:r.nonce||randomString(6),method:t,resource:e.pathname+(e.search||""),host:e.hostname,port:e.port||("http:"===e.protocol?80:443),hash:r.hash,ext:r.ext,app:r.app,dlg:r.dlg};n.hash||!r.payload&&""!==r.payload||(n.hash=calculatePayloadHash(r.payload,a.algorithm,r.contentType));var s=ne.calculateMac(a,n);var i=null!==n.ext&&void 0!==n.ext&&""!==n.ext;var u='Hawk id="'+a.id+'", ts="'+n.ts+'", nonce="'+n.nonce+(n.hash?'", hash="'+n.hash:"")+(i?'", ext="'+n.ext.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'", mac="'+s+'"';n.app&&(u=u+', app="'+n.app+(n.dlg?'", dlg="'+n.dlg:"")+'"');return u};var ie={};var ue=k;var pe=O;var ce=b;var de=o.Buffer;function Multipart(e){this.request=e;this.boundary=ue();this.chunked=false;this.body=null}Multipart.prototype.isChunked=function(e){var t=this;var r=false;var o=e.data||e;o.forEach||t.request.emit("error",new Error("Argument error, options.multipart."));void 0!==e.chunked&&(r=e.chunked);"chunked"===t.request.getHeader("transfer-encoding")&&(r=true);r||o.forEach((function(e){"undefined"===typeof e.body&&t.request.emit("error",new Error("Body attribute missing in multipart."));ce(e.body)&&(r=true)}));return r};Multipart.prototype.setHeaders=function(e){var t=this;e&&!t.request.hasHeader("transfer-encoding")&&t.request.setHeader("transfer-encoding","chunked");var r=t.request.getHeader("content-type");r&&-1!==r.indexOf("multipart")?-1!==r.indexOf("boundary")?t.boundary=r.replace(/.*boundary=([^\s;]+).*/,"$1"):t.request.setHeader("content-type",r+"; boundary="+t.boundary):t.request.setHeader("content-type","multipart/related; boundary="+t.boundary)};Multipart.prototype.build=function(e,t){var r=this;var o=t?new pe:[];function add(e){"number"===typeof e&&(e=e.toString());return t?o.append(e):o.push(de.from(e))}r.request.preambleCRLF&&add("\r\n");e.forEach((function(e){var t="--"+r.boundary+"\r\n";Object.keys(e).forEach((function(r){"body"!==r&&(t+=r+": "+e[r]+"\r\n")}));t+="\r\n";add(t);add(e.body);add("\r\n")}));add("--"+r.boundary+"--");r.request.postambleCRLF&&add("\r\n");return o};Multipart.prototype.onRequest=function(e){var t=this;var r=t.isChunked(e);var o=e.data||e;t.setHeaders(r);t.chunked=r;t.body=t.build(o,r)};ie.Multipart=Multipart;var he={};var le=u;var fe=/^https?:/;function Redirect(e){this.request=e;this.followRedirect=true;this.followRedirects=true;this.followAllRedirects=false;this.followOriginalHttpMethod=false;this.allowRedirect=function(){return true};this.maxRedirects=10;this.redirects=[];this.redirectsFollowed=0;this.removeRefererHeader=false}Redirect.prototype.onRequest=function(e){var t=this;void 0!==e.maxRedirects&&(t.maxRedirects=e.maxRedirects);"function"===typeof e.followRedirect&&(t.allowRedirect=e.followRedirect);void 0!==e.followRedirect&&(t.followRedirects=!!e.followRedirect);void 0!==e.followAllRedirects&&(t.followAllRedirects=e.followAllRedirects);(t.followRedirects||t.followAllRedirects)&&(t.redirects=t.redirects||[]);void 0!==e.removeRefererHeader&&(t.removeRefererHeader=e.removeRefererHeader);void 0!==e.followOriginalHttpMethod&&(t.followOriginalHttpMethod=e.followOriginalHttpMethod)};Redirect.prototype.redirectTo=function(e){var t=this;var r=t.request;var o=null;if(e.statusCode>=300&&e.statusCode<400&&e.caseless.has("location")){var a=e.caseless.get("location");r.debug("redirect",a);if(t.followAllRedirects)o=a;else if(t.followRedirects)switch(r.method){case"PATCH":case"PUT":case"POST":case"DELETE":break;default:o=a;break}}else if(401===e.statusCode){var n=r._auth.onResponse(e);if(n){r.setHeader("authorization",n);o=r.uri}}return o};Redirect.prototype.onResponse=function(e){var t=this;var r=t.request;var o=t.redirectTo(e);if(!o||!t.allowRedirect.call(r,e))return false;r.debug("redirect to",o);e.resume&&e.resume();if(t.redirectsFollowed>=t.maxRedirects){r.emit("error",new Error("Exceeded maxRedirects. Probably stuck in a redirect loop "+r.uri.href));return false}t.redirectsFollowed+=1;fe.test(o)||(o=le.resolve(r.uri.href,o));var a=r.uri;r.uri=le.parse(o);r.uri.protocol!==a.protocol&&delete r.agent;t.redirects.push({statusCode:e.statusCode,redirectUri:o});t.followAllRedirects&&"HEAD"!==r.method&&401!==e.statusCode&&307!==e.statusCode&&(r.method=t.followOriginalHttpMethod?r.method:"GET");delete r.src;delete r.req;delete r._started;if(401!==e.statusCode&&307!==e.statusCode){delete r.body;delete r._form;if(r.headers){r.removeHeader("host");r.removeHeader("content-type");r.removeHeader("content-length");r.uri.hostname!==r.originalHost.split(":")[0]&&r.removeHeader("authorization")}}t.removeRefererHeader||r.setHeader("referer",a.href);r.emit("redirect");r.init();return true};he.Redirect=Redirect;var me={};var ve=u;var ye=T;var ge=["accept","accept-charset","accept-encoding","accept-language","accept-ranges","cache-control","content-encoding","content-language","content-location","content-md5","content-range","content-type","connection","date","expect","max-forwards","pragma","referer","te","user-agent","via"];var be=["proxy-authorization"];function constructProxyHost(e){var t=e.port;var r=e.protocol;var o=e.hostname+":";o+=t||("https:"===r?"443":"80");return o}function constructProxyHeaderWhiteList(e,t){var r=t.reduce((function(e,t){e[t.toLowerCase()]=true;return e}),{});return Object.keys(e).filter((function(e){return r[e.toLowerCase()]})).reduce((function(t,r){t[r]=e[r];return t}),{})}function constructTunnelOptions(e,t){var r=e.proxy;var o={proxy:{host:r.hostname,port:+r.port,proxyAuth:r.auth,headers:t},headers:e.headers,ca:e.ca,cert:e.cert,key:e.key,passphrase:e.passphrase,pfx:e.pfx,ciphers:e.ciphers,rejectUnauthorized:e.rejectUnauthorized,secureOptions:e.secureOptions,secureProtocol:e.secureProtocol};return o}function constructTunnelFnName(e,t){var r="https:"===e.protocol?"https":"http";var o="https:"===t.protocol?"Https":"Http";return[r,o].join("Over")}function getTunnelFn(e){var t=e.uri;var r=e.proxy;var o=constructTunnelFnName(t,r);return ye[o]}function Tunnel(e){this.request=e;this.proxyHeaderWhiteList=ge;this.proxyHeaderExclusiveList=[];"undefined"!==typeof e.tunnel&&(this.tunnelOverride=e.tunnel)}Tunnel.prototype.isEnabled=function(){var e=this;var t=e.request;return"undefined"!==typeof e.tunnelOverride?e.tunnelOverride:"https:"===t.uri.protocol};Tunnel.prototype.setup=function(e){var t=this;var r=t.request;e=e||{};"string"===typeof r.proxy&&(r.proxy=ve.parse(r.proxy));if(!r.proxy||!r.tunnel)return false;e.proxyHeaderWhiteList&&(t.proxyHeaderWhiteList=e.proxyHeaderWhiteList);e.proxyHeaderExclusiveList&&(t.proxyHeaderExclusiveList=e.proxyHeaderExclusiveList);var o=t.proxyHeaderExclusiveList.concat(be);var a=t.proxyHeaderWhiteList.concat(o);var n=constructProxyHeaderWhiteList(r.headers,a);n.host=constructProxyHost(r.uri);o.forEach(r.removeHeader,r);var s=getTunnelFn(r);var i=constructTunnelOptions(r,n);r.agent=s(i);return true};Tunnel.defaultProxyHeaderWhiteList=ge;Tunnel.defaultProxyHeaderExclusiveList=be;me.Tunnel=Tunnel;var qe={};var we=a;var He=s;var _e=i;var Re=u;var ke=p;var xe=c;var Oe=d;var Te=h;var je=l;var Se=f;var Ee=m;var Ce=v;var Ae=y;var Pe=g;var De=e;var ze=b;var Le=q.strict;var Ue=n;var Ne=S;var Me=z;var Fe=L.Querystring;var Be=M.Har;var Ie=Q.Auth;var Je=Z.OAuth;var Qe=ne;var We=ie.Multipart;var Ye=he.Redirect;var Ge=me.Tunnel;var Xe=j;var Ke=o.Buffer;var Ze=Ue.safeStringify;var Ve=Ue.isReadStream;var $e=Ue.toBase64;var et=Ue.defer;var tt=Ue.copy;var rt=Ue.version;var ot=Ne.jar();var at={};function filterForNonReserved(e,t){var r={};for(var o in t){var a=-1===e.indexOf(o);a&&(r[o]=t[o])}return r}function filterOutReservedFunctions(e,t){var r={};for(var o in t){var a=!(-1===e.indexOf(o));var n="function"===typeof t[o];a&&n||(r[o]=t[o])}return r}function requestToJSON(){var e=this;return{uri:e.uri,method:e.method,headers:e.headers}}function responseToJSON(){var e=this;return{statusCode:e.statusCode,body:e.body,headers:e.headers,request:requestToJSON.call(e.request)}}function Request(e){var t=this;if(e.har){t._har=new Be(t);e=t._har.options(e)}xe.Stream.call(t);var r=Object.keys(Request.prototype);var o=filterForNonReserved(r,e);De(t,o);e=filterOutReservedFunctions(r,e);t.readable=true;t.writable=true;e.method&&(t.explicitMethod=true);t._qs=new Fe(t);t._auth=new Ie(t);t._oauth=new Je(t);t._multipart=new We(t);t._redirect=new Ye(t);t._tunnel=new Ge(t);t.init(e)}ke.inherits(Request,xe.Stream);Request.debug=we.env.NODE_DEBUG&&/\brequest\b/.test(we.env.NODE_DEBUG);function debug(){Request.debug&&console.error("REQUEST %s",ke.format.apply(ke,arguments))}Request.prototype.debug=debug;Request.prototype.init=function(e){var t=this;e||(e={});t.headers=t.headers?tt(t.headers):{};for(var r in t.headers)"undefined"===typeof t.headers[r]&&delete t.headers[r];Ce.httpify(t,t.headers);t.method||(t.method=e.method||"GET");t.localAddress||(t.localAddress=e.localAddress);t._qs.init(e);debug(e);t.pool||false===t.pool||(t.pool=at);t.dests=t.dests||[];t.__isRequestRequest=true;if(!t._callback&&t.callback){t._callback=t.callback;t.callback=function(){if(!t._callbackCalled){t._callbackCalled=true;t._callback.apply(t,arguments)}};t.on("error",t.callback.bind());t.on("complete",t.callback.bind(t,null))}if(!t.uri&&t.url){t.uri=t.url;delete t.url}if(t.baseUrl){if("string"!==typeof t.baseUrl)return t.emit("error",new Error("options.baseUrl must be a string"));if("string"!==typeof t.uri)return t.emit("error",new Error("options.uri must be a string when using options.baseUrl"));if(0===t.uri.indexOf("//")||-1!==t.uri.indexOf("://"))return t.emit("error",new Error("options.uri must be a path when using options.baseUrl"));var o=t.baseUrl.lastIndexOf("/")===t.baseUrl.length-1;var a=0===t.uri.indexOf("/");o&&a?t.uri=t.baseUrl+t.uri.slice(1):o||a?t.uri=t.baseUrl+t.uri:""===t.uri?t.uri=t.baseUrl:t.uri=t.baseUrl+"/"+t.uri;delete t.baseUrl}if(!t.uri)return t.emit("error",new Error("options.uri is a required argument"));"string"===typeof t.uri&&(t.uri=Re.parse(t.uri));t.uri.href||(t.uri.href=Re.format(t.uri));if("unix:"===t.uri.protocol)return t.emit("error",new Error("`unix://` URL scheme is no longer supported. Please use the format `http://unix:SOCKET:PATH`"));"unix"===t.uri.host&&t.enableUnixSocket();false===t.strictSSL&&(t.rejectUnauthorized=false);t.uri.pathname||(t.uri.pathname="/");if(!(t.uri.host||t.uri.hostname&&t.uri.port)&&!t.uri.isUnix){var n=Re.format(t.uri);var s='Invalid URI "'+n+'"';0===Object.keys(e).length&&(s+=". This can be caused by a crappy redirection.");t.abort();return t.emit("error",new Error(s))}t.hasOwnProperty("proxy")||(t.proxy=Me(t.uri));t.tunnel=t._tunnel.isEnabled();t.proxy&&t._tunnel.setup(e);t._redirect.onRequest(e);t.setHost=false;if(!t.hasHeader("host")){var i=t.originalHostHeaderName||"host";t.setHeader(i,t.uri.host);t.uri.port&&("80"===t.uri.port&&"http:"===t.uri.protocol||"443"===t.uri.port&&"https:"===t.uri.protocol)&&t.setHeader(i,t.uri.hostname);t.setHost=true}t.jar(t._jar||e.jar);t.uri.port||("http:"===t.uri.protocol?t.uri.port=80:"https:"===t.uri.protocol&&(t.uri.port=443));if(t.proxy&&!t.tunnel){t.port=t.proxy.port;t.host=t.proxy.hostname}else{t.port=t.uri.port;t.host=t.uri.hostname}e.form&&t.form(e.form);if(e.formData){var u=e.formData;var p=t.form();var appendFormValue=function(e,t){t&&t.hasOwnProperty("value")&&t.hasOwnProperty("options")?p.append(e,t.value,t.options):p.append(e,t)};for(var c in u)if(u.hasOwnProperty(c)){var d=u[c];if(d instanceof Array)for(var h=0;h<d.length;h++)appendFormValue(c,d[h]);else appendFormValue(c,d)}}e.qs&&t.qs(e.qs);t.uri.path?t.path=t.uri.path:t.path=t.uri.pathname+(t.uri.search||"");0===t.path.length&&(t.path="/");e.aws&&t.aws(e.aws);e.hawk&&t.hawk(e.hawk);e.httpSignature&&t.httpSignature(e.httpSignature);if(e.auth){Object.prototype.hasOwnProperty.call(e.auth,"username")&&(e.auth.user=e.auth.username);Object.prototype.hasOwnProperty.call(e.auth,"password")&&(e.auth.pass=e.auth.password);t.auth(e.auth.user,e.auth.pass,e.auth.sendImmediately,e.auth.bearer)}t.gzip&&!t.hasHeader("accept-encoding")&&t.setHeader("accept-encoding","gzip, deflate");if(t.uri.auth&&!t.hasHeader("authorization")){var l=t.uri.auth.split(":").map((function(e){return t._qs.unescape(e)}));t.auth(l[0],l.slice(1).join(":"),true)}if(!t.tunnel&&t.proxy&&t.proxy.auth&&!t.hasHeader("proxy-authorization")){var f=t.proxy.auth.split(":").map((function(e){return t._qs.unescape(e)}));var m="Basic "+$e(f.join(":"));t.setHeader("proxy-authorization",m)}t.proxy&&!t.tunnel&&(t.path=t.uri.protocol+"//"+t.uri.host+t.path);e.json&&t.json(e.json);e.multipart&&t.multipart(e.multipart);if(e.time){t.timing=true;t.elapsedTime=t.elapsedTime||0}function setContentLength(){Le(t.body)&&(t.body=Ke.from(t.body));if(!t.hasHeader("content-length")){var e;e="string"===typeof t.body?Ke.byteLength(t.body):Array.isArray(t.body)?t.body.reduce((function(e,t){return e+t.length}),0):t.body.length;e?t.setHeader("content-length",e):t.emit("error",new Error("Argument error, options.body."))}}t.body&&!ze(t.body)&&setContentLength();e.oauth?t.oauth(e.oauth):t._oauth.params&&t.hasHeader("authorization")&&t.oauth(t._oauth.params);var v=t.proxy&&!t.tunnel?t.proxy.protocol:t.uri.protocol;var y={"http:":He,"https:":_e};var g=t.httpModules||{};t.httpModule=g[v]||y[v];if(!t.httpModule)return t.emit("error",new Error("Invalid protocol: "+v));e.ca&&(t.ca=e.ca);if(!t.agent){e.agentOptions&&(t.agentOptions=e.agentOptions);if(e.agentClass)t.agentClass=e.agentClass;else if(e.forever){var b=rt();if(0===b.major&&b.minor<=10)t.agentClass="http:"===v?Ae:Ae.SSL;else{t.agentClass=t.httpModule.Agent;t.agentOptions=t.agentOptions||{};t.agentOptions.keepAlive=true}}else t.agentClass=t.httpModule.Agent}false===t.pool?t.agent=false:t.agent=t.agent||t.getNewAgent();t.on("pipe",(function(e){t.ntick&&t._started&&t.emit("error",new Error("You cannot pipe to this stream after the outbound request has started."));t.src=e;if(Ve(e))t.hasHeader("content-type")||t.setHeader("content-type",Ee.lookup(e.path));else{if(e.headers)for(var r in e.headers)t.hasHeader(r)||t.setHeader(r,e.headers[r]);t._json&&!t.hasHeader("content-type")&&t.setHeader("content-type","application/json");e.method&&!t.explicitMethod&&(t.method=e.method)}}));et((function(){if(!t._aborted){var end=function(){t._form&&(t._auth.hasAuth?t._auth.hasAuth&&t._auth.sentAuth&&t._form.pipe(t):t._form.pipe(t));t._multipart&&t._multipart.chunked&&t._multipart.body.pipe(t);if(t.body)if(ze(t.body))t.body.pipe(t);else{setContentLength();Array.isArray(t.body)?t.body.forEach((function(e){t.write(e)})):t.write(t.body);t.end()}else if(t.requestBodyStream){console.warn("options.requestBodyStream is deprecated, please pass the request object to stream.pipe.");t.requestBodyStream.pipe(t)}else if(!t.src){if(t._auth.hasAuth&&!t._auth.sentAuth){t.end();return}"GET"!==t.method&&"undefined"!==typeof t.method&&t.setHeader("content-length",0);t.end()}};if(t._form&&!t.hasHeader("content-length")){t.setHeader(t._form.getHeaders(),true);t._form.getLength((function(e,r){e||isNaN(r)||t.setHeader("content-length",r);end()}))}else end();t.ntick=true}}))};Request.prototype.getNewAgent=function(){var e=this;var t=e.agentClass;var r={};if(e.agentOptions)for(var o in e.agentOptions)r[o]=e.agentOptions[o];e.ca&&(r.ca=e.ca);e.ciphers&&(r.ciphers=e.ciphers);e.secureProtocol&&(r.secureProtocol=e.secureProtocol);e.secureOptions&&(r.secureOptions=e.secureOptions);"undefined"!==typeof e.rejectUnauthorized&&(r.rejectUnauthorized=e.rejectUnauthorized);if(e.cert&&e.key){r.key=e.key;r.cert=e.cert}e.pfx&&(r.pfx=e.pfx);e.passphrase&&(r.passphrase=e.passphrase);var a="";t!==e.httpModule.Agent&&(a+=t.name);var n=e.proxy;"string"===typeof n&&(n=Re.parse(n));var s=n&&"https:"===n.protocol||"https:"===this.uri.protocol;if(s){if(r.ca){a&&(a+=":");a+=r.ca}if("undefined"!==typeof r.rejectUnauthorized){a&&(a+=":");a+=r.rejectUnauthorized}if(r.cert){a&&(a+=":");a+=r.cert.toString("ascii")+r.key.toString("ascii")}if(r.pfx){a&&(a+=":");a+=r.pfx.toString("ascii")}if(r.ciphers){a&&(a+=":");a+=r.ciphers}if(r.secureProtocol){a&&(a+=":");a+=r.secureProtocol}if(r.secureOptions){a&&(a+=":");a+=r.secureOptions}}if(e.pool===at&&!a&&0===Object.keys(r).length&&e.httpModule.globalAgent)return e.httpModule.globalAgent;a=e.uri.protocol+a;if(!e.pool[a]){e.pool[a]=new t(r);e.pool.maxSockets&&(e.pool[a].maxSockets=e.pool.maxSockets)}return e.pool[a]};Request.prototype.start=function(){var e=this;if(e.timing){var t=(new Date).getTime();var r=Xe()}if(!e._aborted){e._started=true;e.method=e.method||"GET";e.href=e.uri.href;e.src&&e.src.stat&&e.src.stat.size&&!e.hasHeader("content-length")&&e.setHeader("content-length",e.src.stat.size);e._aws&&e.aws(e._aws,true);var o=tt(e);delete o.auth;debug("make request",e.uri.href);delete o.timeout;try{e.req=e.httpModule.request(o)}catch(t){e.emit("error",t);return}if(e.timing){e.startTime=t;e.startTimeNow=r;e.timings={}}var a;e.timeout&&!e.timeoutTimer&&(e.timeout<0?a=0:"number"===typeof e.timeout&&isFinite(e.timeout)&&(a=e.timeout));e.req.on("response",e.onRequestResponse.bind(e));e.req.on("error",e.onRequestError.bind(e));e.req.on("drain",(function(){e.emit("drain")}));e.req.on("socket",(function(t){var r=t._connecting||t.connecting;if(e.timing){e.timings.socket=Xe()-e.startTimeNow;if(r){var onLookupTiming=function(){e.timings.lookup=Xe()-e.startTimeNow};var onConnectTiming=function(){e.timings.connect=Xe()-e.startTimeNow};t.once("lookup",onLookupTiming);t.once("connect",onConnectTiming);e.req.once("error",(function(){t.removeListener("lookup",onLookupTiming);t.removeListener("connect",onConnectTiming)}))}}var setReqTimeout=function(){e.req.setTimeout(a,(function(){if(e.req){e.abort();var t=new Error("ESOCKETTIMEDOUT");t.code="ESOCKETTIMEDOUT";t.connect=false;e.emit("error",t)}}))};if(void 0!==a)if(r){var onReqSockConnect=function(){t.removeListener("connect",onReqSockConnect);e.clearTimeout();setReqTimeout()};t.on("connect",onReqSockConnect);e.req.on("error",(function(e){t.removeListener("connect",onReqSockConnect)}));e.timeoutTimer=setTimeout((function(){t.removeListener("connect",onReqSockConnect);e.abort();var r=new Error("ETIMEDOUT");r.code="ETIMEDOUT";r.connect=true;e.emit("error",r)}),a)}else setReqTimeout();e.emit("socket",t)}));e.emit("request",e.req)}};Request.prototype.onRequestError=function(e){var t=this;if(!t._aborted)if(t.req&&t.req._reusedSocket&&"ECONNRESET"===e.code&&t.agent.addRequestNoreuse){t.agent={addRequest:t.agent.addRequestNoreuse.bind(t.agent)};t.start();t.req.end()}else{t.clearTimeout();t.emit("error",e)}};Request.prototype.onRequestResponse=function(e){var t=this;t.timing&&(t.timings.response=Xe()-t.startTimeNow);debug("onRequestResponse",t.uri.href,e.statusCode,e.headers);e.on("end",(function(){if(t.timing){t.timings.end=Xe()-t.startTimeNow;e.timingStart=t.startTime;t.timings.socket||(t.timings.socket=0);t.timings.lookup||(t.timings.lookup=t.timings.socket);t.timings.connect||(t.timings.connect=t.timings.lookup);t.timings.response||(t.timings.response=t.timings.connect);debug("elapsed time",t.timings.end);t.elapsedTime+=Math.round(t.timings.end);e.elapsedTime=t.elapsedTime;e.timings=t.timings;e.timingPhases={wait:t.timings.socket,dns:t.timings.lookup-t.timings.socket,tcp:t.timings.connect-t.timings.lookup,firstByte:t.timings.response-t.timings.connect,download:t.timings.end-t.timings.response,total:t.timings.end}}debug("response end",t.uri.href,e.statusCode,e.headers)}));if(t._aborted){debug("aborted",t.uri.href);e.resume()}else{t.response=e;e.request=t;e.toJSON=responseToJSON;if(t.httpModule!==_e||!t.strictSSL||e.hasOwnProperty("socket")&&e.socket.authorized){t.originalHost=t.getHeader("host");t.originalHostHeaderName||(t.originalHostHeaderName=t.hasHeader("host"));t.setHost&&t.removeHeader("host");t.clearTimeout();var r=t._jar&&t._jar.setCookie?t._jar:ot;var addCookie=function(e){try{r.setCookie(e,t.uri.href,{ignoreError:true})}catch(e){t.emit("error",e)}};e.caseless=Ce(e.headers);if(e.caseless.has("set-cookie")&&!t._disableCookies){var o=e.caseless.has("set-cookie");Array.isArray(e.headers[o])?e.headers[o].forEach(addCookie):addCookie(e.headers[o])}if(!t._redirect.onResponse(e)){e.on("close",(function(){t._ended||t.response.emit("end")}));e.once("end",(function(){t._ended=true}));var noBody=function(e){return"HEAD"===t.method||e>=100&&e<200||204===e||304===e};var a;if(t.gzip&&!noBody(e.statusCode)){var n=e.headers["content-encoding"]||"identity";n=n.trim().toLowerCase();var s={flush:Oe.Z_SYNC_FLUSH,finishFlush:Oe.Z_SYNC_FLUSH};if("gzip"===n){a=Oe.createGunzip(s);e.pipe(a)}else if("deflate"===n){a=Oe.createInflate(s);e.pipe(a)}else{"identity"!==n&&debug("ignoring unrecognized Content-Encoding "+n);a=e}}else a=e;t.encoding&&(0!==t.dests.length?console.error("Ignoring encoding parameter as this stream is being piped to another stream which makes the encoding option invalid."):a.setEncoding(t.encoding));t._paused&&a.pause();t.responseContent=a;t.emit("response",e);t.dests.forEach((function(e){t.pipeDest(e)}));a.on("data",(function(r){if(t.timing&&!t.responseStarted){t.responseStartTime=(new Date).getTime();e.responseStartTime=t.responseStartTime}t._destdata=true;t.emit("data",r)}));a.once("end",(function(e){t.emit("end",e)}));a.on("error",(function(e){t.emit("error",e)}));a.on("close",(function(){t.emit("close")}));t.callback?t.readResponseBody(e):t.on("end",(function(){t._aborted?debug("aborted",t.uri.href):t.emit("complete",e)}));debug("finish init function",t.uri.href)}}else{debug("strict ssl error",t.uri.href);var i=e.hasOwnProperty("socket")?e.socket.authorizationError:t.uri.href+" does not support SSL";t.emit("error",new Error("SSL Error: "+i))}}};Request.prototype.readResponseBody=function(e){var t=this;debug("reading response's body");var r=[];var o=0;var a=[];t.on("data",(function(e){if(Ke.isBuffer(e)){if(e.length){o+=e.length;r.push(e)}}else a.push(e)}));t.on("end",(function(){debug("end event",t.uri.href);if(t._aborted){debug("aborted",t.uri.href);r=[];o=0}else{if(o){debug("has body",t.uri.href,o);e.body=Ke.concat(r,o);null!==t.encoding&&(e.body=e.body.toString(t.encoding));r=[];o=0}else if(a.length){"utf8"===t.encoding&&a[0].length>0&&"\ufeff"===a[0][0]&&(a[0]=a[0].substring(1));e.body=a.join("")}if(t._json)try{e.body=JSON.parse(e.body,t._jsonReviver)}catch(e){debug("invalid JSON received",t.uri.href)}debug("emitting complete",t.uri.href);"undefined"!==typeof e.body||t._json||(e.body=null===t.encoding?Ke.alloc(0):"");t.emit("complete",e,e.body)}}))};Request.prototype.abort=function(){var e=this;e._aborted=true;e.req?e.req.abort():e.response&&e.response.destroy();e.clearTimeout();e.emit("abort")};Request.prototype.pipeDest=function(e){var t=this;var r=t.response;if(e.headers&&!e.headersSent){if(r.caseless.has("content-type")){var o=r.caseless.has("content-type");e.setHeader?e.setHeader(o,r.headers[o]):e.headers[o]=r.headers[o]}if(r.caseless.has("content-length")){var a=r.caseless.has("content-length");e.setHeader?e.setHeader(a,r.headers[a]):e.headers[a]=r.headers[a]}}if(e.setHeader&&!e.headersSent){for(var n in r.headers)t.gzip&&"content-encoding"===n||e.setHeader(n,r.headers[n]);e.statusCode=r.statusCode}t.pipefilter&&t.pipefilter(r,e)};Request.prototype.qs=function(e,t){var r=this;var o;o=!t&&r.uri.query?r._qs.parse(r.uri.query):{};for(var a in e)o[a]=e[a];var n=r._qs.stringify(o);if(""===n)return r;r.uri=Re.parse(r.uri.href.split("?")[0]+"?"+n);r.url=r.uri;r.path=r.uri.path;"unix"===r.uri.host&&r.enableUnixSocket();return r};Request.prototype.form=function(e){var t=this;if(e){/^application\/x-www-form-urlencoded\b/.test(t.getHeader("content-type"))||t.setHeader("content-type","application/x-www-form-urlencoded");t.body="string"===typeof e?t._qs.rfc3986(e.toString("utf8")):t._qs.stringify(e).toString("utf8");return t}t._form=new Pe;t._form.on("error",(function(e){e.message="form-data: "+e.message;t.emit("error",e);t.abort()}));return t._form};Request.prototype.multipart=function(e){var t=this;t._multipart.onRequest(e);t._multipart.chunked||(t.body=t._multipart.body);return t};Request.prototype.json=function(e){var t=this;t.hasHeader("accept")||t.setHeader("accept","application/json");"function"===typeof t.jsonReplacer&&(t._jsonReplacer=t.jsonReplacer);t._json=true;if("boolean"===typeof e){if(void 0!==t.body){/^application\/x-www-form-urlencoded\b/.test(t.getHeader("content-type"))?t.body=t._qs.rfc3986(t.body):t.body=Ze(t.body,t._jsonReplacer);t.hasHeader("content-type")||t.setHeader("content-type","application/json")}}else{t.body=Ze(e,t._jsonReplacer);t.hasHeader("content-type")||t.setHeader("content-type","application/json")}"function"===typeof t.jsonReviver&&(t._jsonReviver=t.jsonReviver);return t};Request.prototype.getHeader=function(e,t){var r=this;var o,a,n;t||(t=r.headers);Object.keys(t).forEach((function(r){if(r.length===e.length){a=new RegExp(e,"i");n=r.match(a);n&&(o=t[r])}}));return o};Request.prototype.enableUnixSocket=function(){var e=this.uri.path.split(":");var t=e[0];var r=e[1];this.socketPath=t;this.uri.pathname=r;this.uri.path=r;this.uri.host=t;this.uri.hostname=t;this.uri.isUnix=true};Request.prototype.auth=function(e,t,r,o){var a=this;a._auth.onRequest(e,t,r,o);return a};Request.prototype.aws=function(e,t){var r=this;if(!t){r._aws=e;return r}if(4===e.sign_version||"4"===e.sign_version){var o={host:r.uri.host,path:r.uri.path,method:r.method,headers:r.headers,body:r.body};e.service&&(o.service=e.service);var a=je.sign(o,{accessKeyId:e.key,secretAccessKey:e.secret,sessionToken:e.session});r.setHeader("authorization",a.headers.Authorization);r.setHeader("x-amz-date",a.headers["X-Amz-Date"]);a.headers["X-Amz-Security-Token"]&&r.setHeader("x-amz-security-token",a.headers["X-Amz-Security-Token"])}else{var n=new Date;r.setHeader("date",n.toUTCString());var s={key:e.key,secret:e.secret,verb:r.method.toUpperCase(),date:n,contentType:r.getHeader("content-type")||"",md5:r.getHeader("content-md5")||"",amazonHeaders:Te.canonicalizeHeaders(r.headers)};var i=r.uri.path;e.bucket&&i?s.resource="/"+e.bucket+i:e.bucket&&!i?s.resource="/"+e.bucket:!e.bucket&&i?s.resource=i:e.bucket||i||(s.resource="/");s.resource=Te.canonicalizeResource(s.resource);r.setHeader("authorization",Te.authorization(s))}return r};Request.prototype.httpSignature=function(e){var t=this;Se.signRequest({getHeader:function(e){return t.getHeader(e,t.headers)},setHeader:function(e,r){t.setHeader(e,r)},method:t.method,path:t.path},e);debug("httpSignature authorization",t.getHeader("authorization"));return t};Request.prototype.hawk=function(e){var t=this;t.setHeader("Authorization",Qe.header(t.uri,t.method,e))};Request.prototype.oauth=function(e){var t=this;t._oauth.onRequest(e);return t};Request.prototype.jar=function(e){var t=this;var r;0===t._redirect.redirectsFollowed&&(t.originalCookieHeader=t.getHeader("cookie"));if(e){var o=e.getCookieString?e:ot;var a=t.uri.href;o&&(r=o.getCookieString(a))}else{r=false;t._disableCookies=true}r&&r.length&&(t.originalCookieHeader?t.setHeader("cookie",t.originalCookieHeader+"; "+r):t.setHeader("cookie",r));t._jar=e;return t};Request.prototype.pipe=function(e,t){var r=this;if(!r.response){r.dests.push(e);xe.Stream.prototype.pipe.call(r,e,t);return e}if(r._destdata)r.emit("error",new Error("You cannot pipe after data has been emitted from the response."));else{if(!r._ended){xe.Stream.prototype.pipe.call(r,e,t);r.pipeDest(e);return e}r.emit("error",new Error("You cannot pipe after the response has been ended."))}};Request.prototype.write=function(){var e=this;if(!e._aborted){e._started||e.start();return e.req?e.req.write.apply(e.req,arguments):void 0}};Request.prototype.end=function(e){var t=this;if(!t._aborted){e&&t.write(e);t._started||t.start();t.req&&t.req.end()}};Request.prototype.pause=function(){var e=this;e.responseContent?e.responseContent.pause.apply(e.responseContent,arguments):e._paused=true};Request.prototype.resume=function(){var e=this;e.responseContent?e.responseContent.resume.apply(e.responseContent,arguments):e._paused=false};Request.prototype.destroy=function(){var e=this;this.clearTimeout();e._ended?e.response&&e.response.destroy():e.end()};Request.prototype.clearTimeout=function(){if(this.timeoutTimer){clearTimeout(this.timeoutTimer);this.timeoutTimer=null}};Request.defaultProxyHeaderWhiteList=Ge.defaultProxyHeaderWhiteList.slice();Request.defaultProxyHeaderExclusiveList=Ge.defaultProxyHeaderExclusiveList.slice();Request.prototype.toJSON=requestToJSON;qe=Request;var nt=qe;var st={};var it=e;var ut=S;var pt=n;var ct=pt.paramsHaveRequestBody;function initParams(e,t,r){"function"===typeof t&&(r=t);var o={};null!==t&&"object"===typeof t?it(o,t,{uri:e}):it(o,"string"===typeof e?{uri:e}:e);o.callback=r||o.callback;return o}function request(e,t,r){if("undefined"===typeof e)throw new Error("undefined is not a valid uri or options object.");var o=initParams(e,t,r);if("HEAD"===o.method&&ct(o))throw new Error("HTTP HEAD requests MUST NOT include a request body.");return new request.Request(o)}function verbFunc(e){var t=e.toUpperCase();return function(e,r,o){var a=initParams(e,r,o);a.method=t;return request(a,a.callback)}}request.get=verbFunc("get");request.head=verbFunc("head");request.options=verbFunc("options");request.post=verbFunc("post");request.put=verbFunc("put");request.patch=verbFunc("patch");request.del=verbFunc("delete");request["delete"]=verbFunc("delete");request.jar=function(e){return ut.jar(e)};request.cookie=function(e){return ut.parse(e)};function wrapRequestMethod(e,t,r,o){return function(a,n,s){var i=initParams(a,n,s);var u={};it(true,u,t,i);u.pool=i.pool||t.pool;o&&(u.method=o.toUpperCase());"function"===typeof r&&(e=r);return e(u,u.callback)}}request.defaults=function(e,t){var r=this;e=e||{};if("function"===typeof e){t=e;e={}}var o=wrapRequestMethod(r,e,t);var a=["get","head","post","put","patch","del","delete"];a.forEach((function(a){o[a]=wrapRequestMethod(r[a],e,t,a)}));o.cookie=wrapRequestMethod(r.cookie,e,t);o.jar=r.jar;o.defaults=r.defaults;return o};request.forever=function(e,t){var r={};t&&it(r,t);e&&(r.agentOptions=e);r.forever=true;return request.defaults(r)};st=request;request.Request=nt;request.initParams=initParams;Object.defineProperty(request,"debug",{enumerable:true,get:function(){return request.Request.debug},set:function(e){request.Request.debug=e}});var dt=st;export default dt;

